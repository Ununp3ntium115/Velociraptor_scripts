Velociraptor GUI (Web UI)
├─ Access & Identity
│  ├─ Auth Providers
│  │  ├─ Local users (YAML-based, bcrypt)
│  │  ├─ SSO (OIDC/OAuth2) [optional]
│  │  └─ mTLS for API clients (service accounts)
│  ├─ RBAC / ACLs
│  │  ├─ Roles (reader, analyst, investigator, administrator)
│  │  └─ Per-object ACLs (hunts, collections, notebooks, artifacts)
│  └─ Audit Log (GUI and API actions)
├─ Transport & Crypto
│  ├─ HTTPS (server_cert/server_key)
│  ├─ Client TLS (client_cert/client_private_key in MSI)
│  └─ API endpoints (same port as GUI unless proxied)
├─ UI Sections
│  ├─ Overview / Dashboard
│  ├─ Clients
│  │  ├─ Search / Labels
│  │  ├─ Collections (flows)
│  │  └─ Artifacts (VQL-based)
│  ├─ Hunts
│  │  ├─ Definitions (artifact + parameters)
│  │  └─ Results / Downloads
│  ├─ Server
│  │  ├─ Artifacts Repository (built-in + custom)
│  │  ├─ Server Monitoring (logs, queues, filestore)
│  │  └─ Configuration (read-only in GUI)
│  ├─ Notebooks (VQL + Markdown + widgets)
│  ├─ Files / Results
│  └─ Audit & Alerts
├─ Artifact System
│  ├─ Built-in artifacts (system, triage, DFIR)
│  ├─ Custom artifacts (YAML)
│  └─ Versioning & signing [optional]
├─ Data Plane
│  ├─ Filestore (uploaded artifacts, results, binaries)
│  ├─ Datastore (metadata, client records, hunts)
│  └─ Downloads (zip exports, timelines)
└─ Integrations [optional]
   ├─ Reverse Proxy (Nginx/Caddy) for TLS/SSO
   ├─ External Auth (OIDC/LDAP/SAML via proxy)
   └─ SIEM/Webhooks (audit export)
# Velociraptor Installation Tree Guide

## Complete Installation Directory Structure and Process

This document provides comprehensive guidance for Velociraptor installation directory structures, supporting both [SIMPLE-GUI] and production deployments following [DEPLOY-SUCCESS] patterns.

### Installation Types and Structures

#### Type 1: Simple Development/Testing Installation
```
C:\tools\
├── velociraptor.exe                       # Single binary from [CUSTOM-REPO]
└── temp\                                  # Auto-generated by [WORKING-CMD]
    ├── server.config.yaml                # Auto-generated configuration
    ├── server.pem                        # Auto-generated certificate
    ├── server.key                        # Auto-generated private key
    └── datastore\                        # Auto-generated datastore
        ├── clients\
        ├── hunts\
        └── artifacts\
```

**Installation Commands:**
```powershell
# Create directory
New-Item -ItemType Directory -Path "C:\tools" -Force

# Download from [CUSTOM-REPO]
$LatestRelease = Invoke-RestMethod -Uri "https://api.github.com/repos/Ununp3ntium115/velociraptor/releases/latest"
$DownloadUrl = $LatestRelease.assets | Where-Object { $_.name -like "*windows-amd64.exe" } | Select-Object -ExpandProperty browser_download_url
Invoke-WebRequest -Uri $DownloadUrl -OutFile "C:\tools\velociraptor.exe"

# Launch using [WORKING-CMD]
Start-Process PowerShell -ArgumentList "-NoExit", "-Command", "C:\tools\velociraptor.exe gui" -Verb RunAs
```

#### Type 2: Portable Installation
```
D:\VelociraptorPortable\
├── velociraptor.exe                       # Portable binary
├── config\
│   ├── server.config.yaml                # Portable configuration
│   └── client.config.yaml                # Client configuration
├── data\
│   ├── datastore\                        # Portable datastore
│   └── filestore\                        # File storage
├── logs\
│   ├── server.log                        # Application logs
│   └── access.log                        # Access logs
├── certs\
│   ├── server.pem                        # SSL certificates
│   └── server.key                        # Private keys
└── run.bat                               # Startup script
```

**Portable Setup Script (run.bat):**
```batch
@echo off
cd /d "%~dp0"
echo Starting Velociraptor Portable...
velociraptor.exe --config config\server.config.yaml gui
pause
```

#### Type 3: Production Service Installation
```
C:\Program Files\Velociraptor\
├── bin\
│   ├── velociraptor.exe                   # Service binary
│   └── service-wrapper.exe               # Windows service wrapper
├── config\
│   ├── server.config.yaml                # Production configuration
│   └── client.config.yaml                # Client template
└── service\
    ├── install.ps1                       # Service installation script
    ├── uninstall.ps1                     # Service removal script
    └── service.xml                       # Service configuration

C:\ProgramData\Velociraptor\
├── datastore\                            # Production datastore
├── filestore\                            # File storage
├── logs\                                 # Service logs
├── temp\                                 # Temporary files
└── backup\                               # Automated backups
```

**Service Installation Commands:**
```powershell
# Install as Windows Service
New-Service -Name "Velociraptor" -BinaryPathName "C:\Program Files\Velociraptor\bin\velociraptor.exe --config `"C:\Program Files\Velociraptor\config\server.config.yaml`" service" -DisplayName "Velociraptor DFIR Platform" -Description "Digital Forensics and Incident Response Platform" -StartupType Automatic

# Set service permissions
sc.exe config Velociraptor obj= "NT SERVICE\Velociraptor"
```

#### Type 4: Enterprise Multi-Instance Installation
```
C:\Velociraptor\
├── instances\
│   ├── production\
│   │   ├── bin\velociraptor.exe
│   │   ├── config\server.config.yaml
│   │   ├── data\datastore\
│   │   └── logs\
│   ├── staging\
│   │   ├── bin\velociraptor.exe
│   │   ├── config\server.config.yaml
│   │   ├── data\datastore\
│   │   └── logs\
│   └── development\
│       ├── bin\velociraptor.exe
│       ├── config\server.config.yaml
│       ├── data\datastore\
│       └── logs\
├── shared\
│   ├── certs\                            # Shared certificates
│   ├── tools\                            # Shared tools
│   └── artifacts\                        # Shared artifacts
└── management\
    ├── deploy.ps1                        # Deployment script
    ├── backup.ps1                        # Backup script
    └── monitor.ps1                       # Monitoring script
```

### Installation Process Workflows

#### Workflow 1: Quick Start ([SIMPLE-GUI])
1. **Download Binary**
   ```powershell
   # Create tools directory
   New-Item -ItemType Directory -Path "C:\tools" -Force
   
   # Download from [CUSTOM-REPO]
   $ApiUrl = "https://api.github.com/repos/Ununp3ntium115/velociraptor/releases/latest"
   $Release = Invoke-RestMethod -Uri $ApiUrl
   $Asset = $Release.assets | Where-Object { $_.name -like "*windows-amd64.exe" }
   Invoke-WebRequest -Uri $Asset.browser_download_url -OutFile "C:\tools\velociraptor.exe"
   ```

2. **Launch Application**
   ```powershell
   # Use [WORKING-CMD] for immediate deployment
   Start-Process PowerShell -ArgumentList "-NoExit", "-Command", "C:\tools\velociraptor.exe gui" -Verb RunAs
   ```

3. **Verify Installation**
   ```powershell
   # Check process
   Get-Process | Where-Object {$_.ProcessName -like "*velociraptor*"}
   
   # Check port
   netstat -an | findstr :8889
   
   # Test web interface
   Invoke-WebRequest -Uri "https://127.0.0.1:8889" -SkipCertificateCheck
   ```

#### Workflow 2: Production Installation
1. **Pre-Installation Setup**
   ```powershell
   # Create service account
   New-LocalUser -Name "VelociraptorService" -Description "Velociraptor Service Account" -NoPassword
   
   # Create directories
   New-Item -ItemType Directory -Path "C:\Program Files\Velociraptor" -Force
   New-Item -ItemType Directory -Path "C:\ProgramData\Velociraptor" -Force
   ```

2. **Binary Installation**
   ```powershell
   # Download and install binary
   $ApiUrl = "https://api.github.com/repos/Ununp3ntium115/velociraptor/releases/latest"
   $Release = Invoke-RestMethod -Uri $ApiUrl
   $Asset = $Release.assets | Where-Object { $_.name -like "*windows-amd64.exe" }
   Invoke-WebRequest -Uri $Asset.browser_download_url -OutFile "C:\Program Files\Velociraptor\bin\velociraptor.exe"
   ```

3. **Configuration Generation**
   ```powershell
   # Generate production configuration
   & "C:\Program Files\Velociraptor\bin\velociraptor.exe" config generate --config "C:\Program Files\Velociraptor\config\server.config.yaml"
   ```

4. **Service Installation**
   ```powershell
   # Install Windows service
   & "C:\Program Files\Velociraptor\bin\velociraptor.exe" --config "C:\Program Files\Velociraptor\config\server.config.yaml" service install
   
   # Start service
   Start-Service "Velociraptor"
   ```

#### Workflow 3: Upgrade Process
1. **Pre-Upgrade Backup**
   ```powershell
   # Stop service
   Stop-Service "Velociraptor" -Force
   
   # Backup configuration and data
   $BackupDate = Get-Date -Format "yyyyMMdd-HHmmss"
   Compress-Archive -Path "C:\Program Files\Velociraptor\config" -DestinationPath "C:\Backup\velociraptor-config-$BackupDate.zip"
   Compress-Archive -Path "C:\ProgramData\Velociraptor\datastore" -DestinationPath "C:\Backup\velociraptor-data-$BackupDate.zip"
   ```

2. **Binary Upgrade**
   ```powershell
   # Download new version
   $ApiUrl = "https://api.github.com/repos/Ununp3ntium115/velociraptor/releases/latest"
   $Release = Invoke-RestMethod -Uri $ApiUrl
   $Asset = $Release.assets | Where-Object { $_.name -like "*windows-amd64.exe" }
   
   # Backup current binary
   Copy-Item "C:\Program Files\Velociraptor\bin\velociraptor.exe" "C:\Program Files\Velociraptor\bin\velociraptor-backup.exe"
   
   # Install new binary
   Invoke-WebRequest -Uri $Asset.browser_download_url -OutFile "C:\Program Files\Velociraptor\bin\velociraptor.exe"
   ```

3. **Post-Upgrade Verification**
   ```powershell
   # Start service
   Start-Service "Velociraptor"
   
   # Verify functionality
   Start-Sleep 10
   netstat -an | findstr :8889
   Invoke-WebRequest -Uri "https://127.0.0.1:8889" -SkipCertificateCheck
   ```

### Installation Validation and Testing

#### Installation Health Check Script
```powershell
# Test-VelociraptorInstallation.ps1
function Test-VelociraptorInstallation {
    param(
        [string]$InstallationType = "Simple"
    )
    
    $Results = @{}
    
    # Check binary exists
    switch ($InstallationType) {
        "Simple" { 
            $BinaryPath = "C:\tools\velociraptor.exe"
        }
        "Production" { 
            $BinaryPath = "C:\Program Files\Velociraptor\bin\velociraptor.exe"
        }
    }
    
    $Results.BinaryExists = Test-Path $BinaryPath
    
    # Check process running
    $Process = Get-Process | Where-Object {$_.ProcessName -like "*velociraptor*"}
    $Results.ProcessRunning = $Process -ne $null
    
    # Check port listening
    $Port = netstat -an | findstr :8889
    $Results.PortListening = $Port -ne $null
    
    # Check web interface
    try {
        $WebResponse = Invoke-WebRequest -Uri "https://127.0.0.1:8889" -SkipCertificateCheck -UseBasicParsing -TimeoutSec 10
        $Results.WebInterfaceAccessible = $true
    } catch {
        $Results.WebInterfaceAccessible = $false
    }
    
    return $Results
}
```

#### Installation Troubleshooting

**Common Installation Issues:**
1. **Binary Download Fails**
   - Check internet connectivity
   - Verify [CUSTOM-REPO] URL accessibility
   - Check antivirus blocking download

2. **Permission Errors**
   - Ensure Administrator privileges
   - Check directory permissions
   - Verify service account permissions

3. **Port Binding Issues**
   - Check if port 8889 is in use
   - Verify firewall settings
   - Test with different port

4. **Service Installation Fails**
   - Check service account permissions
   - Verify configuration file syntax
   - Review Windows Event Log

### Integration with [USER-MGMT]

#### Post-Installation User Setup
```powershell
# Add admin user after installation
if (Test-Path ".\Add-VelociraptorUser.ps1") {
    .\Add-VelociraptorUser.ps1 -Username "admin" -Password "admin123"
} else {
    # Manual user addition
    & $BinaryPath --config $ConfigPath user add admin --password admin123 --role administrator
}
```

### Maintenance and Monitoring

#### Automated Maintenance Script
```powershell
# Maintenance-VelociraptorInstallation.ps1
# Log rotation
Get-ChildItem "C:\ProgramData\Velociraptor\logs" -Filter "*.log" | Where-Object {$_.LastWriteTime -lt (Get-Date).AddDays(-30)} | Remove-Item

# Cleanup temp files
Get-ChildItem "C:\ProgramData\Velociraptor\temp" | Where-Object {$_.LastWriteTime -lt (Get-Date).AddDays(-7)} | Remove-Item -Recurse

# Health check
$Health = Test-VelociraptorInstallation -InstallationType "Production"
$Health | ConvertTo-Json | Out-File "C:\ProgramData\Velociraptor\health-status.json"
```

This installation tree guide provides comprehensive coverage of all installation scenarios while maintaining compatibility with [DEPLOY-SUCCESS] patterns and [SIMPLE-GUI] approaches.